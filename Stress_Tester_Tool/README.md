# Stress Tester Tool Notes

The script is a stress test for an encoder and decoder system used in the MITRE eCTF 2025 competition. It accepts command-line arguments and runs performance tests on encoding and decoding data frames.

## General Command-Line Args:

| Argument              | Type             | Default        | Description                              |
| :-------------------- | :--------------- | :------------- | :--------------------------------------- |
| `--frame-size` / `-f` | Integer          | `64`           | Size of each frame in bytes              |
| `--test-size` / `-t`  | Integer          | `100000000`    | Total number of bytes to process         |
| `--channels` / `-c`   | List of Integers | `[0, 1, 2, 3]` | List of channels to randomly choose from |

## Inputs for Encoding Test (`encode` subcommand):

| Argument     | Type             | Required?      | Description                                           |
| :----------- | :--------------- | :------------- | :---------------------------------------------------- |
| `secrets`    | Binary File      | ✅ Yes         | Path to a secrets file (used by the encoder)          |
| `--dump`     | JSON File        | ❌ No          | Optional output file for storing encoded frames       |


### Additional Inputs for Encoding Process:
- Randomly chosen **channel** from `--channels` (default: `[0, 1, 2, 3]`).
- Randomly generated data of `--frame-size` bytes using `random.randbytes()`.
- **Current timestamp** in microseconds.

## Inputs for Decoding Test (`decode` subcommand):

| Argument     | Type             | Required?      | Description                                           |
| :----------- | :--------------- | :------------- | :---------------------------------------------------- |
| `port`       | String           | ✅ Yes         | Serial port to the decoder                            |
| `frames`     | JSON File        | ✅ Yes         | JSON file containing base64-encoded frames            |

### Additional Inputs for Decoding Process:
- The script reads **base64-encoded** frames from the JSON file.
- Each frame includes:
  - **Channel** (int)
  - **Base64-encoded data** (bytes)
  - **Timestamp** (microseconds)
 

## Outputs

The script logs messages, writes JSON files, and may exit with error codes.

### General Outputs (Logging)
- Logs generated by **Loguru** and **tqdm** (progress bars).
- Possible log levels:
  - `INFO` - General progress updates (e.g., generating frames, running tests).
  - `ERROR` - Errors during encoding/decoding.
  - `SUCCESS` - Performance meets the threshold.


### Outputs from Encoding Test

| Type                   | Example Output                                     |
| :--------------------- | :------------------------------------------------- |
| Log                    | `"Generating frames (1,562,500 64B frames)..."`    |
| Log                    | `"Running stress test..."`                         |
| Log                    | `"Throughput sufficient: 5,432 KBps > 1,000 KBps"` |
| JSON File (optional)   | Encoded frames dumped to `--dump` file             |

#### JSON File Format (if `--dump` is used):
```
[
    [1, "aGVsbG8gd29ybGQ=", 1700000000000000],  
    [2, "c29tZSByYW5kb20gZGF0YQ==", 1700000000005000]
]
```
*(Base64-encoded data represents a random frame.)*

### Outputs from Decoding Test

| Type                   | Example Output                                     |
| :--------------------- | :------------------------------------------------- |
| Log                    | `"Loading encoded frames..."`                      |
| Log                    | `"Running stress test..."`                         |
| Log                    | `"Throughput sufficient: 1,230 KBps > 10 KBps"`    |

#### If decoding fails on a frame:
```
[ERROR] Errored on frame Frame(channel=1, data=b'invalid_data', timestamp=1700000000000000)!
```

The script then raises an exception.

## Error Conditions & Exit Codes

| Condition                     | Output                                               | Exit Code |
|--------------------------------|-----------------------------------------------------|-----------|
| Encoding or decoding failure   | `"Errored on frame ..."`                            | `-1`      |
| Encoding throughput too low    | `"Throughput too slow! 500 KBps < 1,000 KBps"`      | `-1`      |
| Decoding throughput too low    | `"Throughput too slow! 8 KBps < 10 KBps"`           | `-1`      |
| Successful execution           | `"Throughput sufficient: X KBps > Y KBps"`          | `0`       |


## Summary of Inputs & Outputs

### ✅ Possible Inputs:

#### **Command-line Arguments**
- `--frame-size`, `--test-size`, `--channels`
- **Encode mode:** `secrets` file, `--dump` (optional)
- **Decode mode:** `port`, `frames` JSON file

#### **File Inputs**
- `secrets` (binary file)
- `frames` (JSON file with encoded data)

#### **Random Data Inputs**
- Channels randomly chosen
- Random frame data (`random.randbytes()`)

---

### ✅ Possible Outputs:

#### **Logging Messages**
- Info logs for progress
- Error logs for failures
- Success logs for performance

#### **File Outputs (Optional)**
- JSON file with encoded frames (`--dump` option)

#### **Exit Codes**
- `0` for success
- `-1` for failures (low throughput, encoding/decoding errors)

